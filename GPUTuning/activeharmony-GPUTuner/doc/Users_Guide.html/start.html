<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Active Harmony User&#39;s Guide: Getting Started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Active Harmony User&#39;s Guide
   &#160;<span id="projectnumber">4.6.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('start.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Getting Started </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="start_get"></a>
Downloading the Source                            </h1>
<p>The latest release of Active Harmony can always be found at:</p>
<ul>
<li><a href="http://www.dyninst.org/harmony">http://www.dyninst.org/harmony</a></li>
</ul>
<p>Release tarballs represent snapshots of our development repository in a tested and stable state. If you'd like to try new features or bug fixes, you can download a version directly from our Git repository:</p>
<p>Directly via git:</p><ul>
<li><code>git clone <a href="http://git.dyninst.org/activeharmony.git">http://git.dyninst.org/activeharmony.git</a></code></li>
</ul>
<p>Or, through our repository's web interface at:</p>
<ul>
<li><a href="http://git.dyninst.org/?p=activeharmony.git;a=summary">http://git.dyninst.org/?p=activeharmony.git;a=summary</a></li>
</ul>
<h1><a class="anchor" id="start_install"></a>
Installation                                      </h1>
<p>Once you obtain a copy of the source tree (via tarball or Git), the following utilities are necessary for a successful build:</p>
<ul>
<li>GNU Make</li>
<li>C99-compliant compiler</li>
</ul>
<p>To build and install Active Harmony, issue the following command: </p><pre class="fragment">$ make install
</pre><p>By default, this will create relevant files within the source tree. If you'd like to install the software elsewhere, use the <code>PREFIX</code> variable: </p><pre class="fragment">$ make install PREFIX=$HOME/local/harmony-4.6.0
</pre><p>This make system is also sensitive to standard build flags supplied by the environment: </p><pre class="fragment">$ make CFLAGS=-O3 LDFLAGS=-L/usr/local/lib64
</pre><p>Furthermore, some processing layers bundled with Active Harmony depend on external packages. Build targets with such a dependency are protected behind specific environment variables. The make system will only attempt to build the processing layer if the associated package variable is defined. Otherwise, that target is skipped.</p>
<p>Dependent Package Variables** </p><table class="doxtable">
<tr>
<th>Layer </th><th>Variable </th><th>Package Download URL  </th></tr>
<tr>
<td>TAUdb </td><td><code>LIBTAUDB</code> </td><td><a href="http://www.cs.uoregon.edu/research/tau/downloads.php">http://www.cs.uoregon.edu/research/tau/downloads.php</a> </td></tr>
<tr>
<td>XML Writer </td><td><code>LIBXML2</code> </td><td><a href="http://www.xmlsoft.org/downloads.html">http://www.xmlsoft.org/downloads.html</a> </td></tr>
</table>
<p>Additional details on any of these build variables can be found in their respective Processing Layer documentation page of the User's Guide.</p>
<h2><a class="anchor" id="start_doc"></a>
Building the Documentation                        </h2>
<p>The following software packages will also be necessary to build the documentation:</p>
<ul>
<li>Doxygen</li>
<li>TeX Live (pdflatex)</li>
<li>Inkscape</li>
</ul>
<p>To generate documentation in PDF and HTML formats, issue the following command: </p><pre class="fragment">$ make doc
</pre><p>This should leave <code>.pdf</code> files and <code>.html</code> directories in the <code>doc/</code> directory.</p>
<h1><a class="anchor" id="start_test"></a>
Testing the Installation                          </h1>
<p>There are two separate modes of operation for using Active Harmony, standalone mode and server mode. Both modes are described below and can be used to verify a successful build.</p>
<h2><a class="anchor" id="start_test_standalone"></a>
Standalone Mode                                   </h2>
<p>This is the default model for Active Harmony clients. When initiating a new tuning session, the target application spawns its own dedicated tuning process automatically.</p>
<p>Correct operation relies on the <code>HARMONY_HOME</code> environment variable. It should be set to wherever your version of Active Harmony has been installed. Namely, it should match the <code>PREFIX</code> variable used during <code>make install</code>. For example, the following command would match the installation described in the <a class="el" href="start.html#start_install">Installation</a> section above (assuming Bourne shell semantics): </p><pre class="fragment">$ export HARMONY_HOME=$HOME/local/harmony-4.6.0
</pre><p>If no <code>PREFIX</code> variable was used during <code>make install</code>, <code>HARMONY_HOME</code> should be set to the base directory of the source tree.</p>
<p>Navigate to the <code>example/client_api</code> source directory. The file <code>minimal</code> should exist if the build was successful. If <code>HARMONY_HOME</code> environment variable is set up correctly, the example should be immediately executable. The example may be run as follows: </p><pre class="fragment">$ ./minimal
</pre><p>This should produce the output similar to the following: </p><pre class="fragment">Starting Harmony...
( 481, 0.5269, "pineapple") = 874545.454545
( 490, 0.3286, "oranges") = 1119872.185027
( 655, 0.5611, "grapes") = 749438.602745
( 373, 0.5836, "grapes") = 410325.565456
( 516, 0.7858, "peaches") = 478701.959786

&lt;... snip ...&gt;

(   1, 1.0000, "figs") = 425.000000
(   1, 1.0000, "figs") = 425.000000
(   1, 0.9999, "figs") = 425.042504
(   1, 1.0000, "figs") = 425.000000
(   1, 1.0000, "figs") = 425.000000 (* Best point found. *)
</pre><p>This example uses a simple arithmetic function with six variables to produce a synthetic performance value.</p>
<h2><a class="anchor" id="start_test_server"></a>
Server Mode                                       </h2>
<p>This running model requires tuning clients to communicate to a server via a TCP connection. To run the server: </p><pre class="fragment">$ ./hserver [-p PORT]
</pre><p>Once the server is running, we must inform the client to use it. This is accomplished through two environment variables, <code>HARMONY_HOST</code> and <code>HARMONY_PORT</code>. As a quick example, to run the previous example in server mode, one could use the following command (assuming Bourne shell semantics): </p><pre class="fragment">$ HARMONY_HOST=localhost ./minimal
</pre><p>If <code>HARMONY_HOST</code> is defined, the example will attempt to contact a Harmony Server listening on the specified host (in this case, <code>localhost</code>) on port 1979. If you wish to connect to a server running on a different port, set the <code>HARMONY_PORT</code> environment variable. For example: </p><pre class="fragment">$ export HARMONY_HOST=other.host.net
$ export HARMONY_PORT=2013
</pre><p>An additional perk of running in Server Mode is the web interface. Simply point a javascript-enabled browser to the <em>host:port</em> of a running Harmony Server, and it will provide a visual interface for any tuning sessions under its control.</p>
<h1><a class="anchor" id="start_explore"></a>
Exploring Further                                 </h1>
<p>Now that you have a sample Harmony client working, you can begin to explore the flexibility of the Active Harmony framework. All the examples below make use of the <a class="el" href="cfg.html">Configuration System</a>, which is documented in the User's Manual.</p>
<p>By default, the PRO search strategy is used. It can easily be changed by setting the <code>STRATEGY</code> configuration variable. This way, search strategies are easily comparable. For instance, the following example instructs the session to use a random search strategy instead: </p><pre class="fragment">$ ./minimal STRATEGY=random.so
</pre><p>In addition to changing the core search strategy, additional <a class="el" href="layers.html">processing layers</a> can be easily added to the feedback loop. For instance, if you'd like to write a log of the search session to disk, use the <a class="el" href="logger.html">Point Logger</a> processing layer: </p><pre class="fragment">$ ./minimal LAYERS=log.so LOG_FILE=search.log
</pre><p>Wall-time is a non-deterministic performance metric. Multiple factors such as competing processes, or even CPU temperature can perturb measurement. This phenomenon can be mitigated by performing multiple tests of each point and aggregating the results with the <a class="el" href="agg.html">Aggregator</a> processing layer: </p><pre class="fragment">$ ./minimal LAYERS=agg.so AGG_TIMES=5 AGG_FUNC=median
</pre><p>As described in the <a class="el" href="intro.html#intro_session">Tuning Session</a>, processing layers may be stacked. However, it is important to remember that processing layers are not commutative; their order is important. Consider the following two tuning sessions: </p><pre class="fragment">$ ./minimal LAYERS=agg.so:log.so \
            LOG_FILE=search.log AGG_TIMES=5 AGG_FUNC=median
</pre><p> and </p><pre class="fragment">$ ./minimal LAYERS=log.so:agg.so \
            LOG_FILE=search.log AGG_TIMES=5 AGG_FUNC=median
</pre><p>Only the order of the processing layers have changed, but the second invocation will produce a much smaller log file. This is because the Aggregator is the outermost layer and receives performance reports before the Point Logger. The Point Logger is then unaware of the repeated experiments and only records the resulting aggregated performance value.</p>
<p>In the first invocation, the Point Logger records each performance report before the Aggregator has a chance to unify them. This results in a log file with many repeated experiments.</p>
<p>A real-world example is provided in <code>example/code_generation</code> source directory. That example relies on the code-server, MPI, and CHiLL. Additional details can be found in <code>example/code_generation/README</code> of the source distribution. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
