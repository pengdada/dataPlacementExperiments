#! /usr/bin/python3

import numpy as np
import itertools as it
import itertools
import os
import subprocess
import sys

if __name__ == '__main__':
	app=np.array(['heat_globalmem.out', 'heat.out',  'heat_2d_globalmem.out', 'heat_2d.out'])
	# cupti_metrics= np.array(["shared_load_transactions_per_request","shared_store_transactions_per_request", "local_load_transactions_per_request", "local_store_transactions_per_request", "gld_transactions_per_request", "gst_transactions_per_request", "shared_store_transactions", "shared_load_transactions", "local_load_transactions", "local_store_transactions", "gld_transactions", "gst_transactions", "sysmem_read_transactions", "sysmem_write_transactions", "l2_read_transactions", "l2_write_transactions", "dram_read_transactions", "dram_write_transactions", "global_hit_rate", "local_hit_rate", "gld_requested_throughput", "gst_requested_throughput", "gld_throughput", "gst_throughput", "local_memory_overhead", "tex_cache_hit_rate", "l2_tex_read_hit_rate", "l2_tex_write_hit_rate", "dram_read_throughput", "dram_write_throughput", "tex_cache_throughput", "l2_tex_read_throughput", "l2_tex_write_throughput", "l2_read_throughput", "l2_write_throughput", "sysmem_read_throughput", "sysmem_write_throughput", "local_load_throughput", "local_store_throughput", "shared_load_throughput", "shared_store_throughput", "gld_efficiency", "gst_efficiency", "tex_cache_transactions", "dram_utilization", "sysmem_utilization", "stall_memory_dependency", "stall_texture", "stall_constant_memory_dependency", "shared_efficiency", "inst_compute_ld_st", "ldst_issued", "ldst_executed", "atomic_transactions", "atomic_transactions_per_request", "l2_atomic_throughput", "l2_atomic_transactions", "l2_tex_read_transactions", "stall_memory_throttle", "l2_tex_write_transactions", "shared_utilization", "l2_utilization", "tex_utilization", "ldst_fu_utilization", "tex_fu_utilization", "sysmem_read_utilization", "sysmem_write_utilization", "pcie_total_data_transmitted", "pcie_total_data_received", "inst_executed_global_loads", "inst_executed_local_loads", "inst_executed_shared_loads", "inst_executed_surface_loads", "inst_executed_global_stores", "inst_executed_local_stores", "inst_executed_shared_stores", "inst_executed_surface_stores", "inst_executed_tex_ops", "dram_read_bytes", "dram_write_bytes", "global_load_requests", "local_load_requests", "surface_load_requests", "global_store_requests", "local_store_requests", "surface_store_requests", "l2_global_load_bytes", "l2_local_load_bytes", "l2_surface_load_bytes", "l2_global_atomic_store_bytes", "l2_local_global_store_bytes", "l2_surface_store_bytes", "sysmem_read_bytes", "sysmem_write_bytes", "l2_tex_hit_rate", "texture_load_requests"])
	cupti_metrics= np.array(['sm_efficiency', 'flop_count_sp', 'shared_store_throughput', 'ipc', 'l2_atomic_transactions', 'l2_tex_read_transactions', 'dram_read_throughput', 'atomic_transactions', 'stall_exec_dependency', 'cf_executed', 'flop_count_dp', 'local_store_transactions', 'inst_per_warp', 'warp_nonpred_execution_efficiency', 'flop_count_dp_add', 'shared_efficiency', 'l2_utilization', 'shared_store_transactions', 'tex_cache_throughput', 'tex_fu_utilization', 'local_store_throughput', 'inst_replay_overhead', 'inst_bit_convert', 'shared_load_transactions', 'stall_pipe_busy', 'inst_fp_64', 'gst_transactions_per_request', 'local_memory_overhead', 'gst_efficiency', 'stall_memory_dependency', 'gld_efficiency', 'l2_write_throughput', 'gst_throughput', 'l2_read_transactions', 'l2_atomic_throughput', 'issued_ipc', 'stall_memory_throttle', 'shared_load_throughput', 'flop_sp_efficiency', 'dram_read_transactions', 'stall_not_selected', 'ldst_executed', 'sysmem_write_throughput', 'sysmem_write_transactions', 'gld_throughput', 'gld_transactions', 'stall_constant_memory_dependency', 'stall_inst_fetch', 'sysmem_read_throughput', 'achieved_occupancy', 'flop_count_sp_mul', 'shared_load_transactions_per_request', 'sysmem_write_utilization', 'inst_control', 'l2_write_transactions', 'gst_requested_throughput', 'inst_compute_ld_st', 'local_store_transactions_per_request', 'sysmem_utilization', 'issue_slot_utilization', 'inst_integer', 'sysmem_read_transactions', 'inst_executed', 'flop_count_sp_fma', 'local_load_transactions_per_request', 'dram_write_transactions', 'local_load_transactions', 'sysmem_read_utilization', 'dram_utilization', 'tex_utilization', 'inst_fp_32', 'gst_transactions', 'tex_cache_hit_rate', 'inst_misc', 'cf_fu_utilization', 'warp_execution_efficiency', 'tex_cache_transactions', 'local_load_throughput', 'inst_issued', 'gld_requested_throughput', 'ldst_issued', 'flop_count_sp_add', 'flop_count_dp_mul', 'inst_inter_thread_communication', 'ldst_fu_utilization', 'flop_count_sp_special', 'atomic_transactions_per_request', 'flop_dp_efficiency', 'issue_slots', 'stall_sync', 'l2_read_throughput', 'stall_other', 'stall_texture', 'flop_count_dp_fma', 'cf_issued', 'gld_transactions_per_request', 'eligible_warps_per_cycle', 'shared_store_transactions_per_request', 'dram_write_throughput'])
	no_of_run=3

	for i in range(0, no_of_run):
		for j in range(0, len(app)):
			for k in cupti_metrics:
				executable='./' + str(app[j])
				result = subprocess.run([executable, str(k), app[j]], stdout=subprocess.PIPE)
				result.stdout
